# Client Architecture

The Prism AI Client is a modern single-page application built with **Next.js 14** (App Router). It provides a responsive, high-fidelity interface for users to interact with the research agents.

## Technology Stack

*   **Framework**: Next.js 14 (App Router)
*   **Language**: TypeScript
*   **Styling**: Tailwind CSS
*   **UI Library**: Shadcn UI (Radix Primitives)
*   **State Management**: Zustand
*   **HTTP Client**: Axios
*   **Icons**: Lucide React
*   **Animations**: Framer Motion

## Project Structure

```
client/
├── app/                  # Next.js App Router pages and layouts
│   ├── chat/             # Chat interface routes
│   │   ├── [chatId]/     # Individual chat view
│   │   └── layout.tsx    # Chat layout (Sidebar provider)
│   ├── login/            # Authentication pages
│   └── globals.css       # Global styles (Tailwind directives)
│
├── components/           # React Components
│   ├── chat/             # Chat-specific components
│   │   ├── code-executor.tsx   # Renders code blocks
│   │   ├── report-renderer.tsx # Renders markdown/XML reports
│   │   ├── source-carousel.tsx # Displays research sources
│   │   └── status-indicator.tsx # Shows agent status
│   └── ui/               # Reusable Shadcn UI components
│
├── hooks/                # Custom React Hooks
│   ├── use-mobile.ts     # Mobile detection
│   ├── use-socket.ts     # WebSocket connection logic
│   └── use-toast.ts      # Toast notification hook
│
├── lib/                  # Utilities
│   ├── api.ts            # Axios instance and API calls
│   └── utils.ts          # Tailwind merge helpers
│
└── store/                # Global State (Zustand)
    ├── useAuthStore.ts   # Authentication state
    ├── useChatStore.ts   # Chat history and research state
    └── useSettingsStore.ts # User preferences
```

## State Management

We use **Zustand** for global state management due to its simplicity and performance.

### `useChatStore`
This is the most complex store, managing the entire lifecycle of a research session.
*   **`chats`**: List of historical chats.
*   **`messages`**: Current chat history.
*   **`activeResearch`**: Ephemeral state for the currently running research task, including:
    *   `plan`: The table of contents generated by the Planning Agent.
    *   `sources`: List of sources found during research.
    *   `status`: Current agent status (thinking, action, output).

### `useAuthStore`
Manages user authentication tokens and profile information. It persists state to `localStorage` to keep users logged in.

## Real-Time Updates (WebSocket)

The client connects to the Go WebSocket server to receive real-time updates from the AI workers.

### `use-socket.ts`
This hook manages the WebSocket connection.
1.  Connects to `ws://localhost:8080/ws`.
2.  Listens for incoming messages.
3.  Dispatches actions to `useChatStore` based on the event type (`plan_created`, `source_found`, `report_chunk`, etc.).

## Report Rendering

The final report is streamed as a mix of Markdown and custom XML tags.
The `ReportRenderer` component parses this stream and renders:
*   **Markdown**: Standard text formatting.
*   **Citations**: Converted into clickable badges/links.
*   **Visualizations**: Code blocks (D3, Mermaid) are rendered into interactive diagrams.
